---
title: "Quick MR analysis of LDL on stroke"
author: "Gibran Hemani"
date: 2024-01-20
---

```{r}
library(dplyr)
library(here)
library(tidyr)
library(ggplot2)
```

Load in organised data

```{r}
out <- readRDS(here("data", "stroke_ldl", "organised_summary_data.rds"))
names(out)
```

Reshape

```{r}
dat1 <- subset(out$tophit_pool, target_trait == "LDL" & trait == "LDL")
dat2 <- subset(out$tophit_pool, target_trait == "LDL" & trait == "Stroke")
dat <- inner_join(dat1, dat2, by=c("vid", "pop"))
dat
```

Run models

```{r}
mod1 <- lm(beta.y ~ -1 + beta.x, data=dat, weight=1/dat$se.y^2)
mod2 <- lm(beta.y ~ -1 + beta.x:as.factor(pop), data=dat, weight=1/dat$se.y^2)
smod1 <- summary(mod1)
smod2 <- summary(mod2)
modcomp <- anova(mod1, mod2)
```

Reduced model combining all ancestries

```{r}
smod1
```

Per ancestry analysis

```{r}
smod2
```

Comparison of reduced and full model

```{r}
modcomp
```

Plot results

```{r}
as_tibble(smod2$coef) %>% mutate(pop = levels(as.factor(dat$pop))) %>%
    ggplot(., aes(x=Estimate, y=pop)) +
    geom_point() +
    geom_errorbarh(aes(xmin=Estimate - `Std. Error` * 1.96, xmax=Estimate + `Std. Error` * 1.96), height=0) +
    geom_vline(xintercept=0, linetype="dotted")
```

